---
interface BeamSpec {
  left: string;
  width: string;
  rotation: string;
  duration: number;
  delay: number;
  opacity: number;
}

interface PetalSpec {
  size: number;
  left: string;
  top: string;
  duration: number;
  delay: number;
  hue: string;
}

const beams: BeamSpec[] = [
  { left: '8%', width: '18%', rotation: '-5deg', duration: 32, delay: 0, opacity: 0.35 },
  { left: '38%', width: '12%', rotation: '3deg', duration: 40, delay: -10, opacity: 0.28 },
  { left: '62%', width: '16%', rotation: '-2deg', duration: 36, delay: -4, opacity: 0.3 },
  { left: '80%', width: '10%', rotation: '6deg', duration: 28, delay: -6, opacity: 0.2 },
];

const petals: PetalSpec[] = [
  { size: 120, left: '12%', top: '18%', duration: 28, delay: 0, hue: '135deg' },
  { size: 180, left: '45%', top: '10%', duration: 34, delay: -6, hue: '165deg' },
  { size: 140, left: '70%', top: '22%', duration: 30, delay: -12, hue: '195deg' },
  { size: 90, left: '82%', top: '45%', duration: 24, delay: -8, hue: '155deg' },
  { size: 160, left: '28%', top: '60%', duration: 32, delay: -4, hue: '175deg' },
];
---

<div class="canopy-bloom" aria-hidden="true">
  <div class="gradient-base"></div>

  <div class="sun-beams">
    {beams.map((beam) => (
      <span
        class="sun-beam"
        style={`
          --beam-left: ${beam.left};
          --beam-width: ${beam.width};
          --beam-rotate: ${beam.rotation};
          --beam-duration: ${beam.duration}s;
          --beam-delay: ${beam.delay}s;
          --beam-opacity: ${beam.opacity};
        `}
      />
    ))}
  </div>

  <div class="floating-petals">
    {petals.map((petal) => (
      <span
        class="petal"
        style={`
          --petal-size: ${petal.size}px;
          --petal-left: ${petal.left};
          --petal-top: ${petal.top};
          --petal-duration: ${petal.duration}s;
          --petal-delay: ${petal.delay}s;
          --petal-hue: ${petal.hue};
        `}
      />
    ))}
  </div>

  <div class="mist-overlay"></div>
  <div class="grain"></div>
</div>

<style>
  .canopy-bloom {
    position: fixed;
    inset: 0;
    z-index: var(--z-background, -1);
    overflow: hidden;
    pointer-events: none;
  }

  .gradient-base {
    position: absolute;
    inset: -20%;
    background:
      radial-gradient(circle at 15% 20%, rgba(34, 197, 94, 0.35), transparent 55%),
      radial-gradient(circle at 80% 0%, rgba(134, 239, 172, 0.3), transparent 50%),
      radial-gradient(circle at 50% 80%, rgba(220, 252, 231, 0.45), transparent 60%),
      linear-gradient(180deg, #f7fefb 0%, #e3f8ea 50%, #d0f1df 100%);
    filter: blur(4px);
    /* Subtle vertical shift on scroll */
    transform: translateY(calc(var(--scroll-progress, 0) * -30px));
    transition: transform 0.1s linear;
  }

  .sun-beams {
    position: absolute;
    inset: 0;
    /* Slower parallax for beams container */
    transform: translateY(calc(var(--scroll-progress, 0) * -50px));
    transition: transform 0.15s linear;
  }

  .sun-beam {
    position: absolute;
    top: -10%;
    left: var(--beam-left);
    width: var(--beam-width);
    height: 140%;
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0) 0%,
      rgba(255, 255, 255, 0.75) 35%,
      rgba(254, 250, 237, 0.45) 70%,
      rgba(255, 255, 255, 0) 100%
    );
    mix-blend-mode: screen;
    opacity: var(--beam-opacity);
    transform: rotate(var(--beam-rotate));
    transform-origin: top;
    filter: blur(12px);
    animation: beamPulse var(--beam-duration) ease-in-out infinite alternate;
    animation-delay: var(--beam-delay);
  }

  .floating-petals {
    position: absolute;
    inset: 0;
    /* Petals drift with scroll - slightly faster than beams */
    transform: translateY(calc(var(--scroll-progress, 0) * -70px));
    transition: transform 0.2s linear;
  }

  .petal {
    position: absolute;
    width: var(--petal-size);
    height: var(--petal-size);
    left: var(--petal-left);
    top: var(--petal-top);
    background: radial-gradient(
      circle at 30% 30%,
      rgba(255, 255, 255, 0.8),
      rgba(187, 247, 208, 0.55),
      rgba(34, 197, 94, 0)
    );
    border-radius: 45% 55% 50% 50%;
    filter: blur(8px);
    opacity: 0.4;
    transform-origin: center;
    animation: petalFloat var(--petal-duration) var(--ease-float, cubic-bezier(0.4, 0, 0.2, 1)) infinite alternate;
    animation-delay: var(--petal-delay);
  }

  .petal::after {
    content: '';
    position: absolute;
    inset: 10%;
    border-radius: inherit;
    background: linear-gradient(var(--petal-hue), rgba(34, 197, 94, 0.35), rgba(255, 255, 255, 0.1));
    mix-blend-mode: screen;
    opacity: 0.7;
  }

  .mist-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.05));
    mix-blend-mode: soft-light;
  }

  .grain {
    position: absolute;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Ccircle cx='3' cy='3' r='1' fill='rgba(20,83,45,0.08)'/%3E%3C/svg%3E");
    opacity: 0.25;
    mix-blend-mode: multiply;
    animation: grainDrift 18s linear infinite;
  }

  @keyframes beamPulse {
    0% {
      opacity: calc(var(--beam-opacity) * 0.7);
      transform: rotate(calc(var(--beam-rotate) - 1deg)) scaleY(0.95);
    }
    100% {
      opacity: calc(var(--beam-opacity) * 1.05);
      transform: rotate(calc(var(--beam-rotate) + 1deg)) scaleY(1.05);
    }
  }

  @keyframes petalFloat {
    0% {
      transform: translate3d(-10px, 0, 0) rotate(-6deg);
      opacity: 0.35;
    }
    50% {
      transform: translate3d(12px, -12px, 0) rotate(4deg);
      opacity: 0.6;
    }
    100% {
      transform: translate3d(18px, 6px, 0) rotate(-2deg);
      opacity: 0.4;
    }
  }

  @keyframes grainDrift {
    0% { transform: translate3d(0, 0, 0); }
    100% { transform: translate3d(160px, 160px, 0); }
  }

  @media (prefers-reduced-motion: reduce) {
    .sun-beam,
    .petal,
    .grain {
      animation: none !important;
    }
    .gradient-base,
    .sun-beams,
    .floating-petals {
      transform: none !important;
      transition: none !important;
    }
  }
</style>
