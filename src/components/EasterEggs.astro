---
// Easter Eggs Component
// Hidden surprises for chaotic good energy
---

<script>
  import confetti from 'canvas-confetti';

  // === KONAMI CODE ===
  // Up, Up, Down, Down, Left, Right, Left, Right, B, A
  const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
  let konamiIndex = 0;

  document.addEventListener('keydown', (e) => {
    if (e.code === konamiCode[konamiIndex]) {
      konamiIndex++;
      if (konamiIndex === konamiCode.length) {
        triggerBadgerRain();
        konamiIndex = 0;
      }
    } else {
      konamiIndex = 0;
    }
  });

  function triggerBadgerRain() {
    // Show secret message
    showSecretMessage("ðŸ¦¡ BADGER MODE ACTIVATED! ðŸ¦¡");

    // Epic confetti explosion
    const duration = 5000;
    const end = Date.now() + duration;

    const colors = ['#7ec786', '#5fb0c4', '#f0c05c', '#4eeab5'];

    (function frame() {
      confetti({
        particleCount: 4,
        angle: 60,
        spread: 55,
        origin: { x: 0, y: 0.6 },
        colors: colors,
        disableForReducedMotion: true
      });
      confetti({
        particleCount: 4,
        angle: 120,
        spread: 55,
        origin: { x: 1, y: 0.6 },
        colors: colors,
        disableForReducedMotion: true
      });

      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    })();

    // Change the page title temporarily
    const originalTitle = document.title;
    document.title = "ðŸ¦¡ BADGER BADGER BADGER ðŸ¦¡";
    setTimeout(() => {
      document.title = originalTitle;
    }, 5000);
  }

  // === SECRET CLICK SEQUENCE ===
  // Click the logo 7 times for a surprise
  let logoClickCount = 0;
  let logoClickTimer: ReturnType<typeof setTimeout> | null = null;

  document.querySelectorAll('.logo').forEach(logo => {
    logo.addEventListener('click', (e) => {
      if ((e.target as HTMLElement).closest('nav')) {
        logoClickCount++;

        if (logoClickTimer) clearTimeout(logoClickTimer);
        logoClickTimer = setTimeout(() => {
          logoClickCount = 0;
        }, 2000);

        if (logoClickCount === 7) {
          e.preventDefault();
          triggerSecretDance();
          logoClickCount = 0;
        }
      }
    });
  });

  function triggerSecretDance() {
    showSecretMessage("You found the secret! The badger is pleased.");

    // Make everything wobble
    document.body.classList.add('secret-wobble');
    setTimeout(() => {
      document.body.classList.remove('secret-wobble');
    }, 3000);

    // Confetti burst
    confetti({
      particleCount: 200,
      spread: 180,
      origin: { y: 0.5 },
      colors: ['#7ec786', '#5fb0c4', '#f0c05c', '#4eeab5'],
      disableForReducedMotion: true
    });
  }

  // === SECRET MESSAGE DISPLAY ===
  function showSecretMessage(message: string) {
    // Remove any existing message
    const existing = document.querySelector('.secret-message');
    if (existing) existing.remove();

    const div = document.createElement('div');
    div.className = 'secret-message';
    div.textContent = message;
    document.body.appendChild(div);

    setTimeout(() => {
      div.classList.add('show');
    }, 10);

    setTimeout(() => {
      div.classList.remove('show');
      setTimeout(() => div.remove(), 500);
    }, 3000);
  }

  // === DISCO MODE (type "disco") ===
  let discoBuffer = '';
  document.addEventListener('keydown', (e) => {
    if (e.key.length === 1) {
      discoBuffer += e.key.toLowerCase();
      if (discoBuffer.includes('disco')) {
        triggerDiscoMode();
        discoBuffer = '';
      }
      // Keep buffer small
      if (discoBuffer.length > 10) {
        discoBuffer = discoBuffer.slice(-5);
      }
    }
  });

  function triggerDiscoMode() {
    showSecretMessage("ðŸª© DISCO MODE ðŸª©");
    document.body.classList.add('disco-mode');
    setTimeout(() => {
      document.body.classList.remove('disco-mode');
    }, 5000);
  }

  // === APPRECIATION CLICK ===
  // Click footer copyright 5 times
  let footerClickCount = 0;
  document.addEventListener('click', (e) => {
    if ((e.target as HTMLElement).closest('.footer-bottom')) {
      footerClickCount++;
      if (footerClickCount === 5) {
        showSecretMessage("Thanks for clicking! You're awesome! ðŸ’š");
        confetti({
          particleCount: 50,
          spread: 60,
          origin: { y: 0.8 },
          colors: ['#7ec786', '#5fb0c4'],
          disableForReducedMotion: true
        });
        footerClickCount = 0;
      }
    }
  });
</script>

<style is:global>
  @import '../styles/easter-eggs.css';
</style>
